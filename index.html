<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title></title>
	<style>
		*{
			margin:0;
			padding:0;
		}
		.red{
			color:#ff6060;
		}
	</style>
</head>
<body>
	<div class="container1">
		<h3>Meal upgrades</h3>
		<p>Make your flight more bearable by selecting a meal to match your social and economic status.</p>
		Chosen meal: <select data-bind="options:oMeals,optionsText:'mealName',value:chosenMeal"></select>
		<p>
			You've chosen:
			<b data-bind="text:chosenMeal().description"></b>
			<div>
				(price:<span data-bind="text:FormatPrice(chosenMeal().extraCost)"></span>)
			</div>
			<div>
				(price:<span data-bind="text:formatPrice(chosenMeal().extraCost)"></span>)
			</div>
			<div>
				(price:<span data-bind="text:FormatPriceTwo"></span>)
			</div>
		</p>
		<div data-bind="text:oData.name"></div>
		<div>
			<span data-bind="click:Add">点击加一</span>
		</div>
		<div>
			<span data-bind="text:One"></span>
		</div>
		
		<div>
			<div data-bind="foreach:Meals">
				<div data-bind="text:'$'+formatPrice(extraCost)"></div>
			</div>
			<div data-bind="foreach:Meals">
				<div data-bind="text:'$'+vm.FormatPrice(extraCost)"></div>
			</div>
			<div data-bind="foreach:Meals">
				<div data-bind="text:'$'+$parent.FormatPrice(extraCost)"></div>
			</div>
			<div data-bind="foreach:Meals">
				<div data-bind="text:'$'+$root.FormatPrice(extraCost)"></div>
			</div>
		</div>
	</div>
	<div class="container2">
		<div data-bind="foreach:Meals">
			<div style="color:#ff6060;">$<span data-bind="text:formatPrice(extraCost)"></span></div>
		</div>
		<div style="color:green" data-bind="text:Name()"></div>
		<div style="color:green" data-bind="text:Age()"></div>
		<div style="color:green" data-bind="text:Work()"></div>
		<div style="font-size:20px;">
			<div data-bind="text:First"></div>
			<div data-bind="text:Last"></div>
			<div data-bind="text:First()+Last()"></div>
			<div data-bind="text:FullName()"></div>
		</div> 
		<div>
			<div>
				Enter bid price: <input type="text" data-bind="value:FormatPrice2"/>
			</div>
			<div data-bind="text:Price()"></div>
			<div data-bind="visible: !LastInputValid()">That's not a number!</div>
			<div data-bind="text:Data().name"></div>
		</div>
		<div data-bind="foreach:Meals">
			<div>
				<span data-bind="text:mealName"></span>******* <span data-bind="text:description"></span>************* <span data-bind="text:extraCost"></span>
			</div>
		</div>
		<div data-bind="foreach:Num">
			<div data-bind="text:name,click:vm2.ClickNum"></div>
		</div>
		<div data-bind="foreach:Array1">
			<div style="color:#ff6060;font-size:20px;" data-bind="text:name"></div>
			<div style="color:green;font-size:18px;" data-bind="foreach:arr">
				<div data-bind="text:age"></div>
			</div>
		</div>
		<div style="width:100px;height:40px;line-height:40px;text-align:center;font-size:20px;"></div>
		<div>
			<a target="_blank" data-bind="text:'白度一下',attr:{href:'https://www.baidu.com'},click:ClickHref"></a>
		</div>
		<div>
			<input type="text" data-bind="enable:InputKey"/>
			<textarea name="" id="" cols="30" rows="10" data-bind="enable:InputKey"></textarea>
		</div>
		<div>
			<p>Send me spam: <input type="checkbox" data-bind="checked: wantsSpam"/></p>
			<div data-bind="visible: wantsSpam">
			    Preferred flavors of spam:
			    <div><input type="checkbox" value="cherry" data-bind="checked: spamFlavors"/> Cherry</div>
			    <div><input type="checkbox" value="almond" data-bind="checked: spamFlavors"/> Almond</div>
			    <div><input type="checkbox" value="msg" data-bind="checked: spamFlavors"/> Monosodium Glutamate</div>
			</div>
		</div>
		<div>
			<label><input type="checkbox" data-bind="checked: displayMessage" /> Display message</label>
 
			<div data-bind="if: displayMessage">Here is a message. Astonishing.</div>
		</div>
		<div>
			<ul data-bind="foreach: planets">
			    <li>
			        Planet: <b data-bind="text: name"> </b>
			        <div data-bind="if: capital">
			            Capital: <b data-bind="text: capital.cityName"> </b>
			        </div>
			    </li>
			</ul>
		</div>
		
	</div>
	
<script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="js/knockout.min.js"></script>
<script>
	var oPrice=0;
	var oFirst="xiaoming";
	var oLast="AB";
	var oData={
		name:"xiaoming",
		age:"40",
		work:"actor"
	}
	var oMeals=[
		{ mealName: 'Standard', description: 'Dry crusts of bread', extraCost: 0 },
    	{ mealName: 'Premium', description: 'Fresh bread with cheese', extraCost: 9.95 },
    	{ mealName: 'Deluxe', description: 'Caviar and vintage Dr Pepper', extraCost:18.50} 
	]
	
	var oNum=[
		{name:"a"},
		{name:"b"},
		{name:"c"}
	]
	
	var oArray=[
		{
			name:"a",
			arr:[
				{age:10},
				{age:20},
				{age:30}
			]
		},
		{
			name:"b",
			arr:[
				{age:40},
				{age:50},
				{age:60}
			]
		},
		{
			name:"c",
			arr:[
				{age:70},
				{age:80},
				{age:90}
			]
		}
	]
	
	
</script>
<script>
	var vm={
		One:ko.observable(0),
		chosenMeal:ko.observable(oMeals[0]),
		Meals:ko.observableArray(oMeals),
		FormatPrice:function(price){
			return price==0?"Free":"$"+price.toFixed(2);
		},
		Add:function(){
			this.One(this.One()+1);
		}
	}
	
	var vm2={
		Price:ko.observable(0),
		First:ko.observable(oFirst),
		Last:ko.observable(oLast),
		Meals:ko.observableArray(oMeals),
		Name:ko.observable(oData.name),
		Age:ko.observable(oData.age),
		Work:ko.observable(oData.work),
		LastInputValid:ko.observable(true),
		Data:ko.observable(oData),
		Num:ko.observableArray(oNum),
		Array1:ko.observableArray(oArray),
		InputKey:ko.observable(false),
		wantsSpam: ko.observable(true),
        spamFlavors: ko.observableArray(["cherry", "almond"]),
        displayMessage: ko.observable(false),
        planets: [
            { name: 'Mercury', capital: null }, 
            { name: 'Earth', capital: { cityName: 'Barnsley' } }        
        ],
		ClickNum:function(event){
			console.log(event);
			console.log(event);
			console.log(event.name);
		},
		ClickHref:function(){
			console.log(44);
			return true;
		}
	}
	
	//监控属性的显示订阅
	vm2.Name.subscribe(function(newValue){
		console.log(newValue+": "+newValue.length);
	})
	
	var oAge=vm2.Age.subscribe(function(newValue){
		if(newValue<100){
			console.log(newValue+": "+newValue);
		}else{
			console.log(newValue+": *************");
			console.log(this);
			//停止订阅
			this.dispose();
		}
	})
	
	var oPrice2=vm2.Price.subscribe(function(newValue){
		if(newValue<100){
			console.log(newValue+": "+newValue);
		}else{
			console.log(newValue+": *************");
			console.log(this);
			//停止订阅
			this.dispose();
		}
	})
	
	//依赖监控属性
	vm.FormatPriceTwo=ko.dependentObservable(function(){
		return this.chosenMeal().extraCost==0?"Free":"$"+this.chosenMeal().extraCost.toFixed(2);
	},vm)
	
	vm2.FullName=ko.dependentObservable({
		read:function(){
			return this.First()+this.Last();
		},
		write:function(value){
			this.First(value+"kkkkk");
		}
	},vm2)
	
	//依赖监控属性可写
	vm2.FormatPrice2=ko.dependentObservable({
		read:function(){
			return "$"+this.Price().toFixed(2);
		},
		write:function(value){
			var value=parseFloat(value.replace(/[^\.\d]/g,""));
			if(isNaN(value)){
				this.LastInputValid(false);
			}else{
				this.LastInputValid(true);
				this.Price(isNaN(value)?0:value);
			}
		}
	},vm2)
	
	ko.applyBindings(vm,document.getElementsByClassName("container1")[0]);
	ko.applyBindings(vm2,document.getElementsByClassName("container2")[0]);
	
	function formatPrice(price){
		return price==0?"Free":"$"+price.toFixed(2);
	}
	
	$(function(){
		vm2.Name("AB").Age(20).Work("mote");
		console.log(vm2.Age);
		
		function getFun1(value){
			console.log(value);
		}
		
		function getFun2(value){
			return value;
		}
		
		getFun2(getFun1(2));
		
	}())
</script>
</body>
</html>

